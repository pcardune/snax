extern wasi_unstable {
  func fd_write(fileDescriptor:i32, iovPointer:i32, iovLength: i32, numWrittenPointer: i32):i32;
}

struct String(&u8, i32);

func run() {
  let hello:&u8 = "hello world\n";
  let meow:&u8 = "meowwww\n";
  meow[1] = 'i';

  let foobar = String("foobar\n", 7);

  // let iovec = [hello as i32, 12];
  let iovec = [foobar.0 as i32, foobar.1];

  fd_write(
    1, // stdout
    iovec, // pointer to io vector
    1, // length of io vector
    1220 // where to store number of bytes written
  );

  let moreSnax = String("more snax please!\n", 18);

  printStr(moreSnax);
}

func printStr(s:&String) {
  let iovec = [s.0 as i32, s.1];
  fd_write(
    1, // stdout
    iovec, // pointer to io vector
    1, // length of io vector
    1220 // where to store number of bytes written
  );
}

run();